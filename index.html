<!DOCTYPE html>
<html>
<head>
  <title>Resellers & Customers Map</title>
  <style>
    #map {
      height: 90vh;
      width: 100%;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBaoOUGohHPjpoHWv0PFQai5gqQb7LMbU" defer></script>
</head>
<body onload="initMap()">
  <div id="map"></div>

  <script>
    let map;
    let geocoder;
    let resellerData = [];
    let customerData = [];
    let customerMarkers = [];

    const regionCSVUrl = 'region.csv';
const customerCSVUrl = 'customers.csv';
const resellerCSVUrl = 'resellers.csv';

    function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    zoom: 6,
    center: { lat: 54.5, lng: -3.5 },
  });
  geocoder = new google.maps.Geocoder();

  fetch(regionCSVUrl)
    .then(response => response.text())
    .then(data => {
      const rows = parseCSV(data);
      drawRegions(rows);
    });

  fetch(resellerCSVUrl)
    .then(response => response.text())
    .then(data => {
      resellerData = parseCSV(data);
      plotResellers();
    });

  fetch(customerCSVUrl)
    .then(response => response.text())
    .then(data => {
      customerData = parseCSV(data);
    });
    }

    function parseCSV(content) {
      const rows = content.trim().split("\n");
      const headers = rows[0].split(',');
      return rows.slice(1).map(row => {
        const values = row.split(/,(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/);
        const obj = {};
        headers.forEach((header, i) => {
          obj[header.trim().replace(/^\"|\"$/g, '')] = values[i] ? values[i].replace(/^\"|\"$/g, '').trim() : "";
        });
        return obj;
      });
    }

    function getColorForRegion(regionName) {
      const colors = {
        "North": "#FF0000",
        "South": "#00FF00",
        "East": "#0000FF",
        "West": "#FFA500",
        "Central": "#800080"
      };
      return colors[regionName] || "#888888";
    }

    function drawRegions(rows) {
      rows.forEach(row => {
        const wkt = row.WKT;
        const region = row.description || row.Region || row.name || "Unknown";
        const polygons = Array.from(wkt.matchAll(/POLYGON \(\(([^)]+)\)\)/g));
        polygons.forEach(polygonMatch => {
          const coords = polygonMatch[1].split(',').map(pair => {
            const [lng, lat] = pair.trim().split(' ').map(Number);
            return { lat, lng };
          });
          const polygon = new google.maps.Polygon({
            paths: coords,
            strokeColor: getColorForRegion(region),
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: getColorForRegion(region),
            fillOpacity: 0.35
          });
          polygon.setMap(map);
        });
      });
    }
  </script>
</body>
</html>
